<!DOCTYPE html>
<html>
<head>
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-NSNMPJGPLH"></script>
    <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'G-1B3WJL96J4');
    </script>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LingOrm隨機圖片</title>
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css" rel="stylesheet">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/main.css') }}">
    <link rel="icon" href="{{ url_for('static', filename='favicon/favicon.ico') }}">
</head>
<body>
<!-- Navbar with dark background -->
<nav class="navbar navbar-expand-lg navbar-dark bg-dark">
	<div class="container-fluid">
		<a class="navbar-brand" href="index">LingOrm隨機圖片</a>
		<button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
			<span class="navbar-toggler-icon"></span>
		</button>
		<div class="collapse navbar-collapse" id="navbarNav">
			<ul class="navbar-nav ms-auto">
				<li class="nav-item">
					<a class="nav-link active" aria-current="page" href="index">首頁</a>
				</li>
				<li class="nav-item">
					<a class="nav-link" href="about">關於我</a>
				</li>
			</ul>
		</div>
	</div>
</nav>


<div class="container">
	<div class="inner-div">
		<!-- Bootstrap buttons with custom classes -->
		<button id="previous-button" class="btn btn-secondary btn mb-3" style="display:none;">上一張</button>
		<button id="refresh-button" class="btn btn-warning btn mb-3" style="display:none;">重新整理</button>
		<button id="button" class="btn btn-primary btn mb-3">隨機顯示圖片</button>
	</div>

	<p id="count"></p>
	<div id="info"></div>
	<img id="image" src="" alt="random image">

</div>
    <div class="container">
        <div class="inner-div">
            <div>
                <label><input type="checkbox" name="lingorm" value="lingorm" checked> lingorm</label><br>
                <label><input type="checkbox" name="lingorm" value="ling"> ling</label><br>
                <label><input type="checkbox" name="lingorm" value="orm"> orm</label>
            </div>
        </div>
    </div>

    <script>
        let button = document.getElementById("button");
        let refreshButton = document.getElementById("refresh-button");
        let prevButton = document.getElementById("previous-button");
        let image = document.getElementById("image");
        let info = document.getElementById("info");
        let count = document.getElementById("count");
        let selectedImages = [];
        let currentIndex = -1;
        let randomPhoto = 10;

        function fetchImages() {
            const selectedLingorm = document.querySelector('input[name="lingorm"]:checked');
            
            if (!selectedLingorm) {
                alert('請選擇一個選項！');
                return;
            }

            const requestData = {
                A: ['活動'],
                B: [selectedLingorm.value],
                limit: randomPhoto
            };

            fetch('/get_data', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify(requestData)
            })
            .then(response => {
                if (!response.ok) {
                    throw new Error('Network response was not ok');
                }
                return response.json();
            })
            .then(data => {
                selectedImages = data.Images;
                currentIndex = -1;
                count.innerHTML = `共 ${data.totalImagesCount} 張圖片，已隨機選取 ${randomPhoto} 張圖片。<br>請點選「隨機顯示圖片」查看！`;
                
                // 重置顯示狀態
                image.style.display = "none";
                info.innerHTML = "";
                refreshButton.style.display = "none";
                prevButton.style.display = "none";
                button.textContent = "隨機顯示圖片";
            })
            .catch(error => {
                console.error('Error:', error);
                count.innerHTML = `發生錯誤：${error.message}`;
            });
        }

        // 初始加載
        fetchImages();

        button.addEventListener("click", function () {
            if (currentIndex < selectedImages.length - 1) {
                currentIndex++;
                showImage(currentIndex);
            } else {
                alert("所有圖片都已顯示完畢！請按下「重新整理」按鈕來重新開始。");
                count.innerHTML = `共 ${randomPhoto} 張圖片，所有圖片都已顯示完畢！<br>請按下「重新整理」按鈕來重新開始。`;
            }
        });

        refreshButton.addEventListener("click", function () {
            fetchImages();
        });

        prevButton.addEventListener("click", function () {
            if (currentIndex > 0) {
                currentIndex--;
                showImage(currentIndex);
            } else {
                alert("已經是第一張圖片！");
            }
        });

        function showImage(index) {
            let imageData = selectedImages[index];
            image.src = imageData.full_path;
            image.style.display = "block";
            count.innerHTML = `第 ${index + 1} 張圖片，共 ${selectedImages.length} 張`;

            // 顯示其他按鈕
            refreshButton.style.display = "inline";
            prevButton.style.display = "inline";
            button.textContent = "下一張";
        }
    </script>
<!-- Bootstrap JS (with Popper) -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/js/bootstrap.bundle.min.js"></script>
<script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.5.2/dist/umd/popper.min.js"></script>
</body>
</html>